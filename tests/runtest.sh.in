#! /bin/sh

tmpdir=$(mktemp -d)

export XDG_DATA_HOME=$tmpdir
export XDG_CACHE_HOME=$tmpdir
export XDG_CONFIG_HOME=$tmpdir

tracker-control -rs #2>&1 >/dev/null

export CONTACTSD_PLUGINS_DIRS=@TOP_BUILDDIR@/plugins/telepathy
@TOP_BUILDDIR@/src/contactsd  --log-console &
pid=$!

sleep 5

$1
result=$?

kill $pid

tracker-control -r #2>&1 >/dev/null

if [ $result -eq "0" ]; then
    echo "Test succeeded:" $1
else
    echo "Test failed:" $1
fi

rm -rf $tmpdir

exit $result
